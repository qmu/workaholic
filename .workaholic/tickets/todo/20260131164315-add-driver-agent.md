---
type: enhancement
layer: Config
effort: 1h
created_at: 2026-01-31T16:43:18+09:00
author: a@qmu.jp
---

# Add Driver Agent for Ticket Implementation

## Overview

Add a `driver` agent that executes ticket implementations in an isolated context window. Currently the `/drive` command invokes `drive-workflow` skill directly in the main conversation context. By adding a `driver` agent, each ticket implementation runs in its own context, preserving the main conversation for orchestration and reducing context pollution from implementation details.

New architecture:
```
/drive → [drive-navigator, driver] → drive-workflow
```

## Related History

| Ticket | Relevance |
|--------|-----------|
| [extract-agent-content-to-skills](../archive/feat-20260126-214833/20260127204529-extract-agent-content-to-skills.md) | Established thin agent + comprehensive skill pattern |
| [sync-workaholic-subagent](../archive/feat-20260126-214833/20260127003251-sync-workaholic-subagent.md) | Converted command to subagent for context preservation |
| [parallel-discovery-ticket-command](../archive/feat-20260129-023941/20260129-parallel-discovery-ticket-command.md) | Command invoking multiple subagents pattern |

## Key Files

| File | Purpose |
|------|---------|
| `plugins/core/commands/drive.md` | Command that currently invokes drive-workflow directly |
| `plugins/core/agents/drive-navigator.md` | Existing agent for ticket prioritization |
| `plugins/core/skills/drive-workflow/SKILL.md` | Skill to be preloaded by new driver agent |

## Implementation

### 1. Create driver Agent

Create `plugins/core/agents/driver.md`:

```yaml
---
name: driver
description: Implement a single ticket following drive-workflow skill. Runs in isolated context.
tools: Read, Write, Edit, Bash, Glob, Grep, AskUserQuestion
skills:
  - drive-workflow
  - archive-ticket
---
```

Contents (~25-35 lines):
- Input: ticket path, repo URL
- Instructions:
  1. Read the ticket file
  2. Follow preloaded drive-workflow skill for implementation
  3. Handle user approval response (Approve/Approve and stop/Abandon)
  4. Return result status and commit hash
- Output: JSON with status, commit_hash, and any remaining info

### 2. Update drive Command

Modify `plugins/core/commands/drive.md` Phase 2:

**Before:**
```markdown
For each ticket in the ordered list:
1. Follow the preloaded drive-workflow skill
```

**After:**
```markdown
For each ticket in the ordered list:
1. Invoke driver subagent via Task tool:
   ```
   Task tool with subagent_type: "core:driver"
   prompt: "Implement ticket: <ticket-path>. repo_url: <repo-url>"
   ```
2. Handle driver response...
```

### 3. Remove skill preloads from drive Command

Update drive.md frontmatter:

**Before:**
```yaml
skills:
  - drive-workflow
  - archive-ticket
```

**After:**
```yaml
# No skills - command only orchestrates agents
```

The driver agent now preloads these skills instead.

### 4. Define driver Agent Output Format

```json
{
  "status": "completed" | "stopped" | "abandoned",
  "commit_hash": "abc1234",
  "ticket": ".workaholic/tickets/archive/<branch>/filename.md"
}
```

Status values:
- `"completed"` - User approved, commit created, continue to next
- `"stopped"` - User selected "Approve and stop", stop driving
- `"abandoned"` - User selected "Abandon", ticket moved to fail/

### 5. Update Architecture Documentation

Update `.workaholic/specs/architecture.md` dependency diagram to show:
```
drive --> dn[drive-navigator]
drive --> dr[driver]
dr --> dw[drive-workflow]
dr --> at[archive-ticket]
```

## Verification

1. Verify driver agent file exists with proper frontmatter
2. Verify drive command invokes driver agent via Task tool
3. Verify drive command no longer preloads drive-workflow/archive-ticket
4. Verify each ticket implementation runs in isolated agent context
5. Run `/drive` on a test ticket to verify workflow functions
